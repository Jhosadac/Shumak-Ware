<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Habitaciones - Shumak Ware</title>

    <!--estilos-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Caveat&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">

    <!--libreria de firebase-->
    <script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-database.js"></script>
</head>
<body>
        <div class="search-bar">
            <div class="logo">
                <img src="assests/logo_final.png">
            </div>
            <div class="fechas">
                <div class="search-field entrada">
                    <label for="fechaEntrada"><i class="fas fa-calendar-check"></i> Entrada</label>
                </div>
            
                <div class="search-field salida">
                    <label for="fechaSalida"><i class="fas fa-calendar-times"></i> Salida</label>
                </div>
            </div>
            
            <div class="dropdown">
                <button class="dropdown-btn" id="dropdownBtn">
                    <i class="fas fa-bed"></i> <span>Todas</span>
                    <i class="fas fa-chevron-down"></i>
                </button>
                <div class="dropdown-content" id="dropdownContent">
                    <div class="dropdown-option" data-type="all">Todas</div>
                    <div class="dropdown-option" data-type="simple">Simple</div>
                    <div class="dropdown-option" data-type="doble">Doble</div>
                    <div class="dropdown-option" data-type="matrimonial">Matrimonial</div>
                </div>
            </div>
            <button class="apply-btn" id="aplicarBtn">Buscar</button>
        </div>

        <!-- Header -->
    <header class="main-header">
        <div class="header-wrap">
            <nav class="nav-header">
                    <a href="index.html">Inicio</a>
                    <a href="#">Habitaciones</a>
                    <div class="dropdown-restaurante">
                        <a href="restaurante.html" class="nav-link-restaurante">Restaurante</a>
                        <div class="dropdown-content-restaurante">
                            <a href="menu.html">Menú</a>
                            <a href="reserva-mesa.html">Reserva de Mesa</a>
                        </div>
                    </div>
                    <a href="servicios.html">Servicios</a>
                    <a href="contacto.html">Contacto</a>
                    <a href="reservas.html" class="active">Reservas</a>
            </nav>
        </div>
    </header>
       
    <div class="hab-desc">
        <div class="hab-desc-title">Nuestras habitaciones</div>
        <p>El alojamiento en el hotel Shumak Ware garantiza una estancia inolvidable. Disfruta de sus exclusivas habitaciones 
            completamente equipadas y aprovecha la multitud de actividades que ofrecemos.</p>
    </div>

    <div class="rooms-grid">
        <div class="room-card" id="1">
        <div class="room-img">
            <img src="assests/habitacion_1.jpg">
        </div>
        

        <div class="room-details">
            <h3 class="room-name">Simple</h3>
            <div class="room-price">S/.30 <span>/noche</span></div>
            
            <div class="room-features">
                <div class="feature">
                    <i class="fas fa-bed"></i>
                    <span>1</span>
                </div>
                <div class="feature">
                    <i class="fas fa-user"></i>
                    <span>1 Persona</span>
                </div>
            </div>
            
            <p class="room-description">Este es un buena habitacion</p>
            <button class="book-btn" data-id="${habitacion.id}">
                Reservar Ahora
            </button>
        </div>
    </div>

    <!--room 2-->
        <div class="room-card" id="2">
        <div class="room-img">
            <img src="assests/habitacion_1.jpg">
        </div>
        

        <div class="room-details">
            <h3 class="room-name">Simple</h3>
            <div class="room-price">S/.30 <span>/noche</span></div>
            
            <div class="room-features">
                <div class="feature">
                    <i class="fas fa-bed"></i>
                    <span>1</span>
                </div>
                <div class="feature">
                    <i class="fas fa-user"></i>
                    <span>1 Persona</span>
                </div>
            </div>
            
            <p class="room-description">Este es un buena habitacion</p>
            <button class="book-btn" data-id="${habitacion.id}">
                Reservar Ahora
            </button>
        </div>
    </div>

    <!-- room 3-->
        <div class="room-card" id="3">
        <div class="room-img">
            <img src="assests/habitacion_1.jpg">
        </div>
        

        <div class="room-details">
            <h3 class="room-name">Simple</h3>
            <div class="room-price">S/.30 <span>/noche</span></div>
            
            <div class="room-features">
                <div class="feature">
                    <i class="fas fa-bed"></i>
                    <span>1</span>
                </div>
                <div class="feature">
                    <i class="fas fa-user"></i>
                    <span>1 Persona</span>
                </div>
            </div>
            
            <p class="room-description">Este es un buena habitacion</p>
            <button class="book-btn" data-id="${habitacion.id}">
                Reservar Ahora
            </button>
        </div>
    </div>

    <!--room 4-->
        <div class="room-card" id="4">
        <div class="room-img">
            <img src="assests/habitacion_1.jpg">
        </div>
        

        <div class="room-details">
            <h3 class="room-name">Doble</h3>
            <div class="room-price">S/.40 <span>/noche</span></div>
            
            <div class="room-features">
                <div class="feature">
                    <i class="fas fa-bed"></i>
                    <span>1</span>
                </div>
                <div class="feature">
                    <i class="fas fa-user"></i>
                    <span>1 Persona</span>
                </div>
            </div>
            
            <p class="room-description">Este es un buena habitacion</p>
            <button class="book-btn" data-id="${habitacion.id}">
                Reservar Ahora
            </button>
        </div>
    </div>

    <!--room5-->
        <div class="room-card" id="5">
        <div class="room-img">
            <img src="assests/habitacion_1.jpg">
        </div>
        

        <div class="room-details">
            <h3 class="room-name">Doble</h3>
            <div class="room-price">S/.40 <span>/noche</span></div>
            
            <div class="room-features">
                <div class="feature">
                    <i class="fas fa-bed"></i>
                    <span>1</span>
                </div>
                <div class="feature">
                    <i class="fas fa-user"></i>
                    <span>1 Persona</span>
                </div>
            </div>
            
            <p class="room-description">Este es un buena habitacion</p>
            <button class="book-btn" data-id="${habitacion.id}">
                Reservar Ahora
            </button>
        </div>
    </div>

    <!--room6-->
    <div class="room-card" id="6">
        <div class="room-img">
            <img src="assests/habitacion_1.jpg">
        </div>
        

        <div class="room-details">
            <h3 class="room-name">Doble</h3>
            <div class="room-price">S/.40 <span>/noche</span></div>
            
            <div class="room-features">
                <div class="feature">
                    <i class="fas fa-bed"></i>
                    <span>1</span>
                </div>
                <div class="feature">
                    <i class="fas fa-user"></i>
                    <span>1 Persona</span>
                </div>
            </div>
            
            <p class="room-description">Este es un buena habitacion</p>
            <button class="book-btn" data-id="${habitacion.id}">
                Reservar Ahora
            </button>
        </div>
    </div>

    <!--room7-->
        <div class="room-card" id="7">
        <div class="room-img">
            <img src="assests/habitacion_1.jpg">
        </div>
        

        <div class="room-details">
            <h3 class="room-name">Matrimonial</h3>
            <div class="room-price">S/.50 <span>/noche</span></div>
            
            <div class="room-features">
                <div class="feature">
                    <i class="fas fa-bed"></i>
                    <span>1</span>
                </div>
                <div class="feature">
                    <i class="fas fa-user"></i>
                    <span>1 Persona</span>
                </div>
            </div>
            
            <p class="room-description">Este es un buena habitacion</p>
            <button class="book-btn" data-id="${habitacion.id}">
                Reservar Ahora
            </button>
        </div>
    </div>

    </div>    

    

    <!-- Modal de reserva -->
    <div class="modal-hab" id="reservationModal">
        <div class="modal-hab-content">
            <span class="close-btn" id="closeModal">&times;</span>
            
            <div class="modal-hab-header">
                <h2><i class="fas fa-calendar-check"></i> Completa tu reserva</h2>
                <p>Por favor ingresa tus datos para finalizar la reserva</p>
            </div>
            
            <div class="reservation-summary" id="reservationSummary">
                <!-- Resumen -->
                <h3>Resumen de Reserva</h3>
                    <div class="reservation-item">
                        <span class="reservation-label">Tipo:</span>
                        <span class="reservation-value" id="tipo"> </span>
                    </div>
                    <div class="reservation-item">
                        <span class="reservation-label">Fecha de entrada:</span>
                        <span class="reservation-value" id="fechaEntradaModal"> </span>
                    </div>
                    <div class="reservation-item">
                        <span class="reservation-label">Fecha de salida:</span>
                        <span class="reservation-value" id="fechaSalidaModal"> </span>
                    </div>
                    <div class="reservation-item">
                        <span class="reservation-label">Noches:</span>
                        <span class="reservation-value" id="numNoches"> </span>
                    </div>
                    <div class="reservation-item">
                        <span class="reservation-label">Precio por noche:</span>
                        <span class="reservation-value" id="precio">S/</span>
                    </div>
                    <div class="reservation-item">
                        <span class="reservation-label">Total:</span>
                        <span class="reservation-value" style="color: #e74c3c; font-weight: 700;" id="total"> </span>
                    </div>
            </div>
            
            <form id="reservationForm">
                <div class="form-group-hab">
                    <label for="nombre"><i class="fas fa-user"></i> Nombre completo</label>
                    <input type="text" id="nombre" placeholder="Ingresa tu nombre completo" required>
                </div>
                
                <div class="form-group-hab">
                    <label for="correo"><i class="fas fa-envelope"></i> Correo electrónico</label>
                    <input type="email" id="correo" placeholder="Ingresa tu correo electrónico" required>
                </div>
                
                <div class="form-group-hab">
                    <label for="telefono"><i class="fas fa-phone"></i> Teléfono</label>
                    <input type="tel" id="telefono" placeholder="Ingresa tu número telefónico" required>
                </div>
                
                <button type="submit" class="submit-btn" id="submitReservation">
                    <i class="fas fa-check-circle"></i> Confirmar Reserva
                </button>
            </form>
        </div>
    </div>
    
    <!-- Modal de confirmación -->
    <div class="modal-hab" id="confirmationModal">
        <div class="modal-hab-content">
            <div class="confirmation">
                <i class="fas fa-check-circle"></i>
                <h2>¡Reserva Confirmada!</h2>
                <p>Tu reserva ha sido registrada exitosamente.</p>
                <p>ID de reserva: <strong id="reservationId">RES-2023-001</strong></p>
                <p>Por favor envía el comprobante de pago por WhatsApp para finalizar el proceso.</p>
                
                <button class="submit-btn whatsapp-btn-hab" id="whatsappBtn">
                    <i class="fab fa-whatsapp"></i> Enviar Comprobante por WhatsApp
                </button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-grid">
                <div class="footer-section">
                    <h3>Acerca de Nosotros</h3>
                    <p>Shumak Ware es un hotel-restaurante campestre que combina la naturaleza con la comodidad</p>
                </div>
                <div class="footer-section">
                    <h3>Enlaces Rápidos</h3>
                    <ul>
                        <li><a href="index.html">Inicio</a></li>
                        <li><a href="habitaciones.html">Habitaciones</a></li>
                        <li><a href="restaurante.html">Restaurante</a></li>
                        <li><a href="servicios.html">Servicios</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Contacto</h3>
                    <ul>
                        <li>Teléfono: +51 912 345 678</li>
                        <li>Email: shumakware@gmail.com</li>
                        <li>Dirección: Anta, Huaraz, Ancash</li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                &copy; 2023 Shumak Ware. Todos los derechos reservados.
            </div>
        </div>
    </footer>
    
    <script>
    // ==================== CONFIGURACIÓN FIREBASE ====================
    const firebaseConfig = {
        apiKey: "AIzaSyApq_K7pJmtrLNZcewzxaVXWnVf4Sxynv4",
        authDomain: "shumak-ware.firebaseapp.com",
        databaseURL: "https://shumak-ware-default-rtdb.firebaseio.com",
        projectId: "shumak-ware",
        storageBucket: "shumak-ware.firebasestorage.app",
        messagingSenderId: "64196160181",
        appId: "1:64196160181:web:76852cef50c12a498e6cfc",
        measurementId: "G-8L85H7B12E"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // ==================== VARIABLES Y DATOS ====================
    const habitaciones = [
        { id: 1, tipo: "simple" },
        { id: 2, tipo: "simple" },
        { id: 3, tipo: "simple" },
        { id: 4, tipo: "doble" },
        { id: 5, tipo: "doble" },
        { id: 6, tipo: "doble" },
        { id: 7, tipo: "matrimonial" }
    ];
    const roomsGrid = document.querySelector('.rooms-grid');
    const dropdownBtn = document.getElementById('dropdownBtn');
    const dropdownContent = document.getElementById('dropdownContent');
    const dropdownOptions = document.querySelectorAll('.dropdown-option');
    const aplicarBtn = document.getElementById('aplicarBtn');
    const fechaEntradaInput = document.getElementById('fechaEntrada');
    const fechaSalidaInput = document.getElementById('fechaSalida');

    let selectedType = 'all';
    let fechaEntrada = '';
    let fechaSalida = '';
    let reservas = {};

    // ==================== FILTRO DE TIPO DE HABITACIÓN ====================
    dropdownOptions.forEach(option => {
        option.addEventListener('click', () => {
            selectedType = option.getAttribute('data-type');
            dropdownBtn.querySelector('span').textContent = option.textContent;
            dropdownContent.style.display = 'none';
            actualizarEstadoHabitaciones();
        });
    });
    dropdownBtn.addEventListener('click', () => {
        dropdownContent.style.display = dropdownContent.style.display === 'block' ? 'none' : 'block';
    });
    window.addEventListener('click', (e) => {
        if (!e.target.matches('.dropdown-btn')) dropdownContent.style.display = 'none';
    });

    // ==================== FECHAS ====================
    const today = new Date().toISOString().split('T')[0];
    fechaEntradaInput.min = today;
    fechaSalidaInput.min = today;
    fechaEntradaInput.addEventListener('change', function() {
        fechaSalidaInput.min = this.value;
        fechaEntrada = this.value;
    });
    fechaSalidaInput.addEventListener('change', function() {
        fechaSalida = this.value;
    });

    // ==================== LÓGICA DE DISPONIBILIDAD ====================
    function haySolapamiento(fechaEntrada, fechaSalida, reserva) {
        const entrada1 = new Date(fechaEntrada);
        const salida1 = new Date(fechaSalida);
        const entrada2 = new Date(reserva.fechaEntrada);
        const salida2 = new Date(reserva.fechaSalida);
        return !(salida1 <= entrada2 || entrada1 >= salida2);
    }

    async function cargarReservas() {
        const snapshot = await db.ref('rooms').once('value');
        reservas = snapshot.val() || {};
    }

    function habitacionesOcupadasPorFechas() {
        if (!fechaEntrada || !fechaSalida) return [];
        let ocupadas = [];
        Object.values(reservas).forEach(reserva => {
            if (haySolapamiento(fechaEntrada, fechaSalida, reserva)) {
                ocupadas.push(Number(reserva.idHabitacion));
            }
        });
        return ocupadas;
    }

    function actualizarEstadoHabitaciones() {
        // Ocupa solo los cuartos ya existentes en el HTML
        const ocupadas = habitacionesOcupadasPorFechas();
        habitaciones.forEach(hab => {
            const card = document.getElementById(hab.id);
            if (!card) return;
            // Filtrar por tipo si corresponde
            if (selectedType !== 'all' && hab.tipo !== selectedType) {
                card.style.display = 'none';
            } else {
                card.style.display = '';
                // Estado disponible/ocupado
                if (ocupadas.includes(hab.id)) {
                    card.classList.add('room-status', 'unavailable');
                    card.querySelector('.book-btn').disabled = true;
                    card.querySelector('.book-btn').style.background = "#ccc";
                    card.querySelector('.book-btn').style.cursor = "not-allowed";
                } else {
                    card.classList.remove('unavailable');
                    card.querySelector('.book-btn').disabled = false;
                    card.querySelector('.book-btn').style.background = "";
                    card.querySelector('.book-btn').style.cursor = "";
                }
            }
        });
    }

    // ==================== BUSCAR HABITACIONES ====================
    aplicarBtn.addEventListener('click', async () => {
        fechaEntrada = fechaEntradaInput.value;
        fechaSalida = fechaSalidaInput.value;
        await cargarReservas();
        actualizarEstadoHabitaciones();
    });

    // ==================== MOSTRAR TODAS AL INICIO ====================
window.addEventListener('DOMContentLoaded', async () => {
    await cargarReservas();
    actualizarEstadoHabitaciones();
});
    </script>
</body>
</html>
