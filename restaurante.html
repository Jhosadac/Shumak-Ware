<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurante - Shumak Ware</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">

    <!--importando firebase-->
    <script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-database.js"></script>
</head>
<body>
    <!-- Header -->
    <header class="main-header">
        <div class="header-wrap">
            <div class="logo">
                <img src="assests/logo.png" alt="logo">
            </div>
            <nav class="nav-header">
                <ul class="main-menu">
                    <li><a href="index.html">Inicio</a></li>
                    <li><a href="habitaciones.html">Habitaciones</a></li>
                    <li><a href="restaurante.html" class="active">Restaurante</a></li>
                    <li><a href="servicios.html">Servicios</a></li>
                    <li><a href="contacto.html">Contacto</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Barra de opciones del restaurante -->
    <nav class="restaurant-nav">
        <div class="container">
            <ul class="restaurant-options">
                <li><a href="#"><i class="fas fa-utensils"></i> Menú</a></li>
                <li><a href="#" id="reservasBtn"><i class="fas fa-calendar-check"></i> Reservas</a></li>
                <li><a href="#" id="pedirBtn" class="disabled"><i class="fas fa-shopping-cart"></i> Pedir</a></li>
            </ul>
        </div>
    </nav>

    <!-- Sección de ubicación -->
    <section class="location-section">
        <div class="container">
            <h2>Ingresa tu ubicación para realizar pedidos</h2>
            <div class="location-input">
                <input type="text" id="ubicacionInput" placeholder="Ingresa tu dirección">
                <button id="confirmarUbicacion">Confirmar Ubicación</button>
            </div>
        </div>
    </section>

    <!-- Carrusel de Entradas -->
    <section>
        <div class="container">
            <div class="underline">Entradas</div>
            <div class="category-container">
                <div class="category-description">
                    <h3>Deliciosos Inicios</h3>
                    <p>Nuestras entradas son preparadas con ingredientes frescos y de la más alta calidad. Ideales para comenzar tu experiencia gastronómica con el mejor sabor.</p>
                </div>
                <div class="category-slider">
                    <div class="category-slides" id="entradasSlides">
                        <!-- Slide 1 -->
                        <div class="category-slide">
                            <div class="slide-image-rest" style="background-image: url('https://images.unsplash.com/photo-1600891964599-f61ba0e24092?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80');"></div>
                            <h3 class="slide-title-rest">Ceviche de Trucha</h3>
                            <p class="slide-description-rest">Trucha fresca marinada en limón con cebolla roja, ají limo y cilantro</p>
                            <div class="slide-price-rest">S/ 28.90</div>
                            <div class="quantity-controls">
                                <button class="quantity-btn minus" disabled>-</button>
                                <span class="quantity-value">0</span>
                                <button class="quantity-btn plus" disabled>+</button>
                            </div>
                            <button class="add-to-cart" disabled>Añadir</button>
                        </div>
                        <!-- Slide 2 -->
                        <div class="category-slide">
                            <div class="slide-image-rest" style="background-image: url('https://images.unsplash.com/photo-1519708227418-c8fd9a32b7a2?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80');"></div>
                            <h3 class="slide-title-rest">Causa Rellena</h3>
                            <p class="slide-description-rest">Papa amarilla con ají, rellena de pollo deshilachado y palta</p>
                            <div class="slide-price-rest">S/ 22.50</div>
                            <div class="quantity-controls">
                                <button class="quantity-btn minus" disabled>-</button>
                                <span class="quantity-value">0</span>
                                <button class="quantity-btn plus" disabled>+</button>
                            </div>
                            <button class="add-to-cart" disabled>Añadir</button>
                        </div>
                    </div>
                    <div class="slider-controls">
                        <button class="prev-btn"><i class="fas fa-chevron-left"></i></button>
                        <button class="next-btn"><i class="fas fa-chevron-right"></i></button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Carrusel de Sopas -->
    <section>
        <div class="container">
            <div class="underline">Sopas</div>
            <div class="category-container">
                <div class="category-slider">
                    <div class="category-slides" id="sopasSlides">
                        <!-- Slide 1 -->
                        <div class="category-slide">
                            <div class="slide-image-rest" style="background-image: url('https://images.unsplash.com/photo-1547592166-23ac45744acd?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1171&q=80');"></div>
                            <h3 class="slide-title-rest">Chupe de Camarones</h3>
                            <p class="slide-description-rest">Cremosa sopa con camarones, leche, huevo y ají panca</p>
                            <div class="slide-price-rest">S/ 32.90</div>
                            <div class="quantity-controls">
                                <button class="quantity-btn minus" disabled>-</button>
                                <span class="quantity-value">0</span>
                                <button class="quantity-btn plus" disabled>+</button>
                            </div>
                            <button class="add-to-cart" disabled>Añadir</button>
                        </div>
                        <!-- Slide 2 -->
                        <div class="category-slide">
                            <div class="slide-image-rest" style="background-image: url('https://images.unsplash.com/photo-1603989872380-0c6d0a139ffe?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80');"></div>
                            <h3 class="slide-title-rest">Sopa de Quinua</h3>
                            <p class="slide-description-rest">Sopa nutritiva de quinua con verduras frescas</p>
                            <div class="slide-price-rest">S/ 18.50</div>
                            <div class="quantity-controls">
                                <button class="quantity-btn minus" disabled>-</button>
                                <span class="quantity-value">0</span>
                                <button class="quantity-btn plus" disabled>+</button>
                            </div>
                            <button class="add-to-cart" disabled>Añadir</button>
                        </div>
                    </div>
                    <div class="slider-controls">
                        <button class="prev-btn"><i class="fas fa-chevron-left"></i></button>
                        <button class="next-btn"><i class="fas fa-chevron-right"></i></button>
                    </div>
                </div>
                <div class="category-description">
                    <h3>Reconfortantes Caldos</h3>
                    <p>Nuestras sopas son elaboradas con recetas tradicionales y los mejores ingredientes, perfectas para entrar en calor y disfrutar de sabores auténticos.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Carrusel de Segundos -->
    <section>
        <div class="container">
            <div class="underline">Segundos</div>
            <div class="category-container">
                <div class="category-description">
                    <h3>Platos de Fondo</h3>
                    <p>Platos principales que destacan por su sabor y presentación, elaborados con productos locales y técnicas tradicionales.</p>
                </div>
                <div class="category-slider">
                    <div class="category-slides" id="segundosSlides">
                        <!-- Slide 1 -->
                        <div class="category-slide">
                            <div class="slide-image-rest" style="background-image: url('https://images.unsplash.com/photo-1606755962773-d324e7a84393?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80');"></div>
                            <h3 class="slide-title-rest">Lomo Saltado</h3>
                            <p class="slide-description-rest">Trozos de lomo de res salteados con cebolla, tomate y papas fritas</p>
                            <div class="slide-price-rest">S/ 38.90</div>
                            <div class="quantity-controls">
                                <button class="quantity-btn minus" disabled>-</button>
                                <span class="quantity-value">0</span>
                                <button class="quantity-btn plus" disabled>+</button>
                            </div>
                            <button class="add-to-cart" disabled>Añadir</button>
                        </div>
                        <!-- Slide 2 -->
                        <div class="category-slide">
                            <div class="slide-image-rest" style="background-image: url('https://images.unsplash.com/photo-1626082927389-6cd097cee6a6?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80');"></div>
                            <h3 class="slide-title-rest">Trucha a la Parrilla</h3>
                            <p class="slide-description-rest">Trucha fresca a la parrilla con guarnición de papas andinas y ensalada</p>
                            <div class="slide-price-rest">S/ 34.50</div>
                            <div class="quantity-controls">
                                <button class="quantity-btn minus" disabled>-</button>
                                <span class="quantity-value">0</span>
                                <button class="quantity-btn plus" disabled>+</button>
                            </div>
                            <button class="add-to-cart" disabled>Añadir</button>
                        </div>
                    </div>
                    <div class="slider-controls">
                        <button class="prev-btn"><i class="fas fa-chevron-left"></i></button>
                        <button class="next-btn"><i class="fas fa-chevron-right"></i></button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Carrusel de Bebidas -->
    <section>
        <div class="container">
            <div class="underline">Bebidas</div>
            <div class="category-container">
                <div class="category-slider">
                    <div class="category-slides" id="bebidasSlides">
                        <!-- Slide 1 -->
                        <div class="category-slide">
                            <div class="slide-image-rest" style="background-image: url('https://images.unsplash.com/photo-1551024709-8f23befc6f87?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1257&q=80');"></div>
                            <h3 class="slide-title-rest">Chicha Morada</h3>
                            <p class="slide-description-rest">Refrescante bebida de maíz morado con piña y canela</p>
                            <div class="slide-price-rest">S/ 8.90</div>
                            <div class="quantity-controls">
                                <button class="quantity-btn minus" disabled>-</button>
                                <span class="quantity-value">0</span>
                                <button class="quantity-btn plus" disabled>+</button>
                            </div>
                            <button class="add-to-cart" disabled>Añadir</button>
                        </div>
                        <!-- Slide 2 -->
                        <div class="category-slide">
                            <div class="slide-image-rest" style="background-image: url('https://images.unsplash.com/photo-1595981267035-7b04ca84a82d?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80');"></div>
                            <h3 class="slide-title-rest">Emoliente</h3>
                            <p class="slide-description-rest">Bebida caliente de hierbas con linaza y cebada</p>
                            <div class="slide-price-rest">S/ 7.50</div>
                            <div class="quantity-controls">
                                <button class="quantity-btn minus" disabled>-</button>
                                <span class="quantity-value">0</span>
                                <button class="quantity-btn plus" disabled>+</button>
                            </div>
                            <button class="add-to-cart" disabled>Añadir</button>
                        </div>
                    </div>
                    <div class="slider-controls">
                        <button class="prev-btn"><i class="fas fa-chevron-left"></i></button>
                        <button class="next-btn"><i class="fas fa-chevron-right"></i></button>
                    </div>
                </div>
                <div class="category-description">
                    <h3>Refrescos y Calientes</h3>
                    <p>Bebidas tradicionales y refrescantes para acompañar tus platillos o disfrutar en cualquier momento.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Modal de Reservas -->
    <div id="reservasModal" class="modal-rest">
        <div class="modal-rest-content">
            <span class="close">&times;</span>
            <div class="underline">Reserva una Mesa</div>
            <div class="disponibilidad-info">
                <p><strong>Mesas disponibles:</strong></p>
                <p>• Al aire libre: <span id="disponibilidadAireLibre">10</span> mesas (máx. 40 personas)</p>
                <p>• Adentro: <span id="disponibilidadAdentro">10</span> mesas (máx. 40 personas)</p>
                <p><small>Cada mesa tiene capacidad para 4 personas</small></p>
            </div>
            <form id="reservaForm">
                <div class="form-group-rest">
                    <label for="nombre">Nombre:</label>
                    <input type="text" id="nombre" name="nombre" required>
                </div>
                <div class="form-group-rest">
                    <label for="correo">Correo:</label>
                    <input type="email" id="correo" name="correo" required>
                </div>
                <div class="form-group-rest">
                    <label for="telefono">Teléfono:</label>
                    <input type="tel" id="telefono" name="telefono" required>
                </div>
                <div class="form-group-rest">
                    <label for="fecha">Fecha:</label>
                    <input type="date" id="fecha" name="fecha" required min="">
                </div>
                <div class="form-group-rest">
                    <label for="hora">Hora:</label>
                    <input type="time" id="hora" name="hora" required>
                </div>
                <div class="form-group-rest">
                    <label for="personas">Número de personas:</label>
                    <input type="number" id="personas" name="personas" min="1" max="20" required>
                </div>
                <div class="form-group-rest">
                    <label for="zona">Zona:</label>
                    <select id="zona" name="zona" required>
                        <option value="">Seleccione...</option>
                        <option value="aire_libre">Al Aire Libre</option>
                        <option value="adentro">Adentro</option>
                    </select>
                </div>
                <button type="submit" id="enviarReserva">Reservar</button>
            </form>
        </div>
    </div>

    <!-- Modal de Pedido -->
    <div id="pedidoModal" class="modal-rest">
        <div class="modal-rest-content">
            <span class="close">&times;</span>
            <div class="underline">Finalizar Pedido <br>
            <p>Por favor ingresa tus datos para finalizar la reserva</p>
            </div>
            
            <div class="direccion-info">
                <h3>Dirección de Entrega</h3>
                <p id="direccionPedido">Calle Principal 123, Ciudad</p>
            </div>
            
            <div class="pedido-resumen">
                <div class="resumen-header">
                    <h3>Resumen de Pedido</h3>
                    <span>Artículos: <span id="totalArticulos">0</span></span>
                </div>
                <div id="resumenCarrito">
                    <!-- Los elementos del carrito se añadirán aquí dinámicamente -->
                    <div class="empty-cart-message" id="emptyCartMessage">
                        <i class="fas fa-shopping-cart"></i>
                        <h3>Tu carrito está vacío</h3>
                        <p>No has agregado ningún producto. Por favor, selecciona algunos productos antes de realizar tu pedido.</p>
                    </div>
                </div>
                <div class="resumen-total">
                    <span>Total:</span>
                    <span id="totalPedido">S/ 0.00</span>
                </div>
            </div>
            
            <div class="opciones-container">
                <div class="opciones-group">
                    <h3>Salsas</h3>
                    <div class="opciones-list">
                        <div class="opcion-item">
                            <input type="checkbox" id="ketchup" name="salsas" value="Kétchup">
                            <label for="ketchup">Kétchup</label>
                        </div>
                        <div class="opcion-item">
                            <input type="checkbox" id="mayonesa" name="salsas" value="Mayonesa">
                            <label for="mayonesa">Mayonesa</label>
                        </div>
                        <div class="opcion-item">
                            <input type="checkbox" id="mostaza" name="salsas" value="Mostaza">
                            <label for="mostaza">Mostaza</label>
                        </div>
                        <div class="opcion-item">
                            <input type="checkbox" id="aji" name="salsas" value="Ají">
                            <label for="aji">Ají</label>
                        </div>
                        <div class="opcion-item">
                            <input type="checkbox" id="bbq" name="salsas" value="BBQ">
                            <label for="bbq">BBQ</label>
                        </div>
                        <div class="opcion-item">
                            <input type="checkbox" id="tartara" name="salsas" value="Tártara">
                            <label for="tartara">Tártara</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="form-group-rest">
                <h3>Método de Entrega</h3>
                <div class="tipo-entrega">
                    <div class="entrega-option" id="deliveryOption">
                        <i class="fas fa-motorcycle"></i>
                        <h4>Delivery</h4>
                        <p>Envío a domicilio</p>
                    </div>
                    <div class="entrega-option" id="recojoOption">
                        <i class="fas fa-store"></i>
                        <h4>Recojo en Tienda</h4>
                        <p>Recoge en nuestro local</p>
                    </div>
                </div>
            </div>

            <!--Formulario-->
            <form id="reservationForm">
                <div class="form-group-rest">
                    <label for="nombrePedido"><i class="fas fa-user"></i> Nombre completo</label>
                    <input type="text" id="nombrePedido" placeholder="Ingresa tu nombre completo" required>
                </div>
                <div class="form-group-rest">
                    <label for="telefonoPedido"><i class="fas fa-phone"></i> Teléfono</label>
                    <input type="tel" id="telefonoPedido" placeholder="Ingresa tu número telefónico" required>
                </div>
                
                <button type="submit" class="submit-btn" id="confirmarPedido">
                    <i class="fas fa-check-circle"></i> Confirmar pedido
                </button>
            </form>
            
        </div>
    </div>

    <!-- Modal de confirmación -->
    <div class="modal-hab" id="confirmationModal">
        <div class="modal-hab-content">
            <div class="confirmation">
                <i class="fas fa-check-circle"></i>
                <h2>¡Reserva Confirmada!</h2>
                <p>Tu reserva ha sido registrada exitosamente.</p>
                <p>ID de reserva: <strong id="reservationId">RES-2023-001</strong></p>
                <p>Por favor tome captura de su numero de reserva.</p>
            </div>
        </div>
    </div>
    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-grid">
                <div class="footer-section">
                    <h3>Acerca de Nosotros</h3>
                    <p>Shumak Ware es un hotel-restaurante campestre que combina la naturaleza con la comodidad</p>
                </div>
                <div class="footer-section">
                    <h3>Enlaces Rápidos</h3>
                    <ul>
                        <li><a href="index.html">Inicio</a></li>
                        <li><a href="habitaciones.html">Habitaciones</a></li>
                        <li><a href="restaurante.html">Restaurante</a></li>
                        <li><a href="servicios.html">Servicios</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Contacto</h3>
                    <ul>
                        <li><i class="fas fa-phone"></i> +51 912 345 678</li>
                        <li><i class="fas fa-envelope"></i> shumakware@gmail.com</li>
                        <li><i class="fas fa-map-marker-alt"></i> Anta, Huaraz, Ancash</li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                &copy; 2023 Shumak Ware. Todos los derechos reservados.
            </div>
        </div>
    </footer>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyApq_K7pJmtrLNZcewzxaVXWnVf4Sxynv4",
            authDomain: "shumak-ware.firebaseapp.com",
            databaseURL: "https://shumak-ware-default-rtdb.firebaseio.com",
            projectId: "shumak-ware",
            storageBucket: "shumak-ware.firebasestorage.app",
            messagingSenderId: "64196160181",
            appId: "1:64196160181:web:76852cef50c12a498e6cfc",
            measurementId: "G-8L85H7B12E"
        };

        //Inicializar firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // Variables globales
        let ubicacionIngresada = false;
        let carrito = [];
        let metodoEntrega = 'delivery';
        
        // Referencias a elementos del DOM
        const ubicacionInput = document.getElementById('ubicacionInput');
        const confirmarUbicacionBtn = document.getElementById('confirmarUbicacion');
        const pedirBtn = document.getElementById('pedirBtn');
        const minusBtns = document.querySelectorAll('.quantity-btn.minus');
        const plusBtns = document.querySelectorAll('.quantity-btn.plus');
        const addToCartBtns = document.querySelectorAll('.add-to-cart');
        const reservasBtn = document.getElementById('reservasBtn');
        const reservasModal = document.getElementById('reservasModal');
        const pedidoModal = document.getElementById('pedidoModal');
        const closeBtns = document.querySelectorAll('.close');
        const reservaForm = document.getElementById('reservaForm');
        const direccionPedido = document.getElementById('direccionPedido');
        const resumenCarrito = document.getElementById('resumenCarrito');
        const totalArticulos = document.getElementById('totalArticulos');
        const totalPedido = document.getElementById('totalPedido');
        const emptyCartMessage = document.getElementById('emptyCartMessage');
        const deliveryOption = document.getElementById('deliveryOption');
        const recojoOption = document.getElementById('recojoOption');
        const confirmarPedidoBtn = document.getElementById('confirmarPedido');
        const nombrePedidoInput = document.getElementById('nombrePedido');
        const telefonoPedidoInput = document.getElementById('telefonoPedido');
        const confirmationModal = document.getElementById('confirmationModal');
        
        // Establecer fecha mínima como hoy
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('fecha').min = today;
        
        // Confirmar ubicación
        confirmarUbicacionBtn.addEventListener('click', () => {
            if (ubicacionInput.value.trim() === '') {
                alert('Por favor ingresa una ubicación válida');
                return;
            }
            
            ubicacionIngresada = true;
            pedirBtn.classList.remove('disabled');
            
            // Habilitar controles de cantidad
            minusBtns.forEach(btn => btn.disabled = false);
            plusBtns.forEach(btn => btn.disabled = false);
            addToCartBtns.forEach(btn => btn.disabled = false);
            
            alert(`Ubicación confirmada: ${ubicacionInput.value}`);
        });
        
        // Función para manejar el carrusel
        function setupSlider(slidesContainerId) {
            const slidesContainer = document.getElementById(slidesContainerId);
            const slides = slidesContainer.querySelectorAll('.category-slide');
            const prevBtn = slidesContainer.parentElement.querySelector('.prev-btn');
            const nextBtn = slidesContainer.parentElement.querySelector('.next-btn');
            
            let currentIndex = 0;
            const slideCount = slides.length;
            
            function updateSlider() {
                slidesContainer.style.transform = `translateX(-${currentIndex * 100}%)`;
            }
            
            prevBtn.addEventListener('click', () => {
                currentIndex = (currentIndex - 1 + slideCount) % slideCount;
                updateSlider();
            });
            
            nextBtn.addEventListener('click', () => {
                currentIndex = (currentIndex + 1) % slideCount;
                updateSlider();
            });
        }
        
        // Inicializar carruseles
        setupSlider('entradasSlides');
        setupSlider('sopasSlides');
        setupSlider('segundosSlides');
        setupSlider('bebidasSlides');
        
        // Manejar controles de cantidad
        document.querySelectorAll('.quantity-controls').forEach(control => {
            const minusBtn = control.querySelector('.minus');
            const plusBtn = control.querySelector('.plus');
            const quantityValue = control.querySelector('.quantity-value');
            
            minusBtn.addEventListener('click', () => {
                let value = parseInt(quantityValue.textContent);
                if (value > 0) {
                    value--;
                    quantityValue.textContent = value;
                }
            });
            
            plusBtn.addEventListener('click', () => {
                let value = parseInt(quantityValue.textContent);
                value++;
                quantityValue.textContent = value;
            });
        });
        
        // Manejar añadir al carrito
        addToCartBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                const slide = this.closest('.category-slide');
                const title = slide.querySelector('.slide-title-rest').textContent;
                const priceText = slide.querySelector('.slide-price-rest').textContent;
                const price = parseFloat(priceText.replace('S/ ', ''));
                const quantity = parseInt(slide.querySelector('.quantity-value').textContent);
                const category = slide.closest('.container').querySelector('.underline').textContent.toLowerCase();
                if (quantity === 0) {
                    alert('Por favor selecciona al menos un ítem');
                    return;
                }
                
                // Buscar si el producto ya está en el carrito
                const productoExistente = carrito.find(item => item.nombre === title);
                
                if (productoExistente) {
                    // Actualizar cantidad
                    productoExistente.cantidad += quantity;
                } else {
                    // Añadir nuevo producto al carrito
                    carrito.push({
                        nombre: title,
                        precio: price,
                        cantidad: quantity,
                        categoria: category 
                    });
                }
                
                alert(`Añadido al carrito: ${quantity} x ${title} - ${priceText}`);
                slide.querySelector('.quantity-value').textContent = '0';
                
                // Actualizar contador de carrito
                actualizarContadorCarrito();
            });
        });
        
        // Actualizar contador de artículos en carrito
        function actualizarContadorCarrito() {
            const totalItems = carrito.reduce((total, item) => total + item.cantidad, 0);
            totalArticulos.textContent = totalItems;
        }
        
        // Abrir modal de reservas
        reservasBtn.addEventListener('click', function(e) {
            e.preventDefault();
            reservasModal.style.display = 'block';
        });
        
        // Abrir modal de pedido
        pedirBtn.addEventListener('click', function(e) {
            e.preventDefault();
            
            if (!ubicacionIngresada) {
                alert('Por favor confirma tu ubicación antes de realizar un pedido');
                return;
            }
            
            // Actualizar dirección en el modal
            direccionPedido.textContent = ubicacionInput.value;
            
            // Actualizar resumen de carrito
            actualizarResumenCarrito();
            
            // Mostrar modal
            pedidoModal.style.display = 'block';
        });
        
        // Cerrar modales
        closeBtns.forEach(btn => {
            btn.addEventListener('click', function() {
                reservasModal.style.display = 'none';
                pedidoModal.style.display = 'none';
            });
        });
        
        // Cerrar modal al hacer clic fuera
        window.addEventListener('click', function(e) {
            if (e.target === reservasModal) {
                reservasModal.style.display = 'none';
            }
            if (e.target === pedidoModal) {
                pedidoModal.style.display = 'none';
            }
            if (e.target === confirmationModal) {
                confirmationModal.classList.remove('show');
            }
        });
        
        // Actualizar resumen de carrito
        function actualizarResumenCarrito() {
            resumenCarrito.innerHTML = '';
            
            if (carrito.length === 0) {
                emptyCartMessage.style.display = 'block';
                totalPedido.textContent = 'S/ 0.00';
                return;
            }
            
            emptyCartMessage.style.display = 'none';
            
            let total = 0;
            
            carrito.forEach(item => {
                const subtotal = item.precio * item.cantidad;
                total += subtotal;
                
                const itemElement = document.createElement('div');
                itemElement.className = 'resumen-item';
                itemElement.innerHTML = `
                    <div>
                        <div>${item.nombre}</div>
                        <div style="font-size: 0.9rem; color: #666;">${item.cantidad} x S/ ${item.precio.toFixed(2)}</div>
                    </div>
                    <div>S/ ${subtotal.toFixed(2)}</div>
                `;
                
                resumenCarrito.appendChild(itemElement);
            });
            
            totalPedido.textContent = `S/ ${total.toFixed(2)}`;
        }
        
        // Seleccionar método de entrega
        deliveryOption.addEventListener('click', function() {
            deliveryOption.classList.add('selected');
            recojoOption.classList.remove('selected');
            metodoEntrega = 'delivery';
        });
        
        recojoOption.addEventListener('click', function() {
            recojoOption.classList.add('selected');
            deliveryOption.classList.remove('selected');
            metodoEntrega = 'recojo';
        });
        
        // Seleccionar delivery por defecto
        deliveryOption.classList.add('selected');

        // Generar código aleatorio de 10 dígitos
        function generarCodigo() {
            return Math.floor(1000000000 + Math.random() * 9000000000).toString();
        }
        
        // Confirmar pedido
        confirmarPedidoBtn.addEventListener('click', function() {
            // Validar que haya productos en el carrito
            if (carrito.length === 0) {
                alert('No has seleccionado ningún producto. Por favor, añade productos a tu carrito antes de continuar.');
                return;
            }

            
            // Validar nombre y teléfono
            const nombre = nombrePedidoInput.value.trim();
            const telefono = telefonoPedidoInput.value.trim();
            
            if (!nombre || !telefono) {
                alert('Por favor, ingresa tu nombre y número de teléfono.');
                return;
            }
            
            // Obtener salsas seleccionadas
            const salsasSeleccionadas = Array.from(document.querySelectorAll('input[name="salsas"]:checked'))
                .map(input => input.value);

            // Agrupar productos por categoría
            const productosPorCategoria = {
                entradas: [],
                sopas: [],
                segundos: [],
                bebidas: []
            };

            carrito.forEach(item => {
                if (productosPorCategoria[item.categoria]) {
                    productosPorCategoria[item.categoria].push({
                        nombre: item.nombre,
                        precio: item.precio,
                        cantidad: item.cantidad
                    });
                }
            });

            // Obtener fecha y hora actual
            const fechaActual = new Date();
            const fecha = fechaActual.toISOString().split('T')[0];
            const hora = fechaActual.toTimeString().split(' ')[0].substring(0,5); // Formato HH:MM
            
            // Construir objeto pedido
            const pedido = {
                direccion: ubicacionInput.value,
                fecha: fecha,
                hora: hora,
                nombre: nombre,
                telefono: telefono,
                entradas: productosPorCategoria.entradas,
                sopas: productosPorCategoria.sopas,
                segundos: productosPorCategoria.segundos,
                bebidas: productosPorCategoria.bebidas,
                salsas: salsasSeleccionadas,
                metodoEntrega: metodoEntrega
            };
            
            // Generar código de pedido
            const codigoPedido = generarCodigo();
            
            // Enviar a Firebase
            const dbRef = database.ref('pedidos/' + codigoPedido);
            dbRef.set(pedido)
            .then(() => {
                alert('¡Pedido realizado con éxito! Tu código de pedido es: ' + codigoPedido);
            
            // Limpiar carrito
            carrito = [];
            actualizarContadorCarrito();
            
            // Cerrar modal
            pedidoModal.style.display = 'none';
        })    
        
        .catch(error => {
                console.error('Error al guardar el pedido:', error);
                alert('Hubo un error al procesar tu pedido. Por favor, intenta de nuevo.');
            });
        });

        //modal de reservas
        // Referencia a la base de datos para reservas
    const reservasRef = database.ref('reservas');
    
    // Función para convertir hora a minutos
    function horaAMinutos(hora) {
        const [horas, minutos] = hora.split(':').map(Number);
        return horas * 60 + minutos;
    }

    // Función para verificar conflicto de horarios
    function hayConflictoHorario(existingReservations, fecha, hora, zona) {
        const horaMinutos = horaAMinutos(hora);
        const fechaActual = new Date();
        
        for (const key in existingReservations) {
            const reserva = existingReservations[key];
            
            // Solo verificar reservas en la misma fecha y zona que sean futuras
            if (reserva.fecha === fecha && reserva.zona === zona) {
                // Convertir fecha de reserva a objeto Date para comparación
                const [anio, mes, dia] = fecha.split('-').map(Number);
                const reservaDate = new Date(anio, mes - 1, dia);
                
                // Verificar si la reserva es futura (o de hoy pero con hora posterior)
                if (reservaDate > fechaActual || 
                   (reservaDate.toDateString() === fechaActual.toDateString() && 
                    horaAMinutos(reserva.hora) > fechaActual.getHours() * 60 + fechaActual.getMinutes())) {
                    
                    const reservaHoraMinutos = horaAMinutos(reserva.hora);
                    
                    // Verificar conflicto con margen de 30 minutos
                    if (Math.abs(reservaHoraMinutos - horaMinutos) <= 30) {
                        return true; // Hay conflicto
                    }
                }
            }
        }
        return false; // No hay conflicto
    }

    // Manejar envío de formulario de reserva
    reservaForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const nombre = document.getElementById('nombre').value;
        const correo = document.getElementById('correo').value;
        const telefono = document.getElementById('telefono').value;
        const fecha = document.getElementById('fecha').value;
        const hora = document.getElementById('hora').value;
        const personas = parseInt(document.getElementById('personas').value);
        const zona = document.getElementById('zona').value;
        
        // Validar campos
        if (!nombre || !correo || !telefono || !fecha || !hora || !personas || !zona) {
            alert('Por favor completa todos los campos');
            return;
        }
        
        // Validar número de personas
        if (personas < 1 || personas > 20) {
            alert('Por favor ingresa un número válido de personas (1-20)');
            return;
        }
        
        // Obtener fecha y hora actual
        const ahora = new Date();
        const [anioReserva, mesReserva, diaReserva] = fecha.split('-').map(Number);
        const reservaDate = new Date(anioReserva, mesReserva - 1, diaReserva);
        
        // Verificar si la fecha de reserva es pasada
        if (reservaDate < ahora && reservaDate.toDateString() !== ahora.toDateString()) {
            alert('No puedes reservar para una fecha pasada');
            return;
        }
        
        // Verificar si la hora de reserva es pasada (para reservas de hoy)
        if (reservaDate.toDateString() === ahora.toDateString()) {
            const horaMinutos = horaAMinutos(hora);
            const horaActualMinutos = ahora.getHours() * 60 + ahora.getMinutes();
            
            if (horaMinutos < horaActualMinutos) {
                alert('No puedes reservar para una hora pasada');
                return;
            }
        }
        
        // Obtener todas las reservas existentes
        reservasRef.once('value').then((snapshot) => {
            const reservas = snapshot.val();
            
            // Verificar si hay conflicto de horario (solo con reservas futuras)
            if (reservas && hayConflictoHorario(reservas, fecha, hora, zona)) {
                alert('Lo sentimos, no hay disponibilidad para ese horario. Por favor elige otro horario o zona.');
                return;
            }
            
            // Crear objeto de reserva
            const reserva = {
                nombre,
                correo,
                telefono,
                fecha,
                hora,
                personas,
                zona,
                timestamp: new Date().toISOString() // Para ordenamiento
            };

             // Generar ID de reserva
            const timestamp = new Date().getTime();
            reservationId = `RES-${timestamp}`;
            
            // Guardar en Firebase
            reservasRef.push(reserva)
                .then(() => {
                    alert('¡Reserva realizada con éxito! Te esperamos el ' + fecha + ' a las ' + hora);
                    reservaForm.reset();
                    reservasModal.style.display = 'none';
                    // Mostrar modal de confirmación
                    reservationIdEl.textContent = reservationId;
                    confirmationModal.classList.add('show');
                })
                .catch((error) => {
                    console.error('Error al guardar reserva:', error);
                    alert('Hubo un error al guardar tu reserva. Por favor intenta de nuevo.');
                });
        });
    });

    // Función para actualizar disponibilidad de mesas
    function actualizarDisponibilidad() {
        const ahora = new Date();
        
        // Inicializar contadores
        let aireLibreDisponible = 10;
        let adentroDisponible = 10;
        
        // Obtener todas las reservas
        reservasRef.once('value').then((snapshot) => {
            const reservas = snapshot.val();
            
            if (reservas) {
                Object.keys(reservas).forEach(key => {
                    const reserva = reservas[key];
                    const [anio, mes, dia] = reserva.fecha.split('-').map(Number);
                    const reservaDate = new Date(anio, mes - 1, dia);
                    
                    // Solo considerar reservas futuras o de hoy con hora posterior
                    if (reservaDate > ahora || 
                       (reservaDate.toDateString() === ahora.toDateString() && 
                        horaAMinutos(reserva.hora) > ahora.getHours() * 60 + ahora.getMinutes())) {
                        
                        if (reserva.zona === 'aire_libre') {
                            aireLibreDisponible--;
                        } else if (reserva.zona === 'adentro') {
                            adentroDisponible--;
                        }
                    }
                });
            }
            
            // Actualizar UI con disponibilidad
            document.getElementById('disponibilidadAireLibre').textContent = aireLibreDisponible;
            document.getElementById('disponibilidadAdentro').textContent = adentroDisponible;
        });
    }

    // Actualizar disponibilidad al cargar la página
    actualizarDisponibilidad();
    
    // Actualizar disponibilidad cada minuto
    setInterval(actualizarDisponibilidad, 60000);

    </script>
</body>
</html>
