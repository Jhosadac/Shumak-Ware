<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Servicios - Shumak Ware</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
     <!--importando firebase-->
    <script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.20.0/firebase-database.js"></script>
</head>
<body>
    <!-- Header -->
    <header class="main-header">
        <div class="header-wrap">
            <div class="logo">
                <img src="assests/logo.png" alt="logo">
            </div>
            <nav class="nav-header">
                <ul class="main-menu">
                    <li><a href="index.html">Inicio</a></li>
                    <li><a href="habitaciones.html">Habitaciones</a></li>
                    <li><a href="restaurante.html">Restaurante</a></li>
                    <li><a href="servicios.html" class="active">Servicios</a></li>
                    <li><a href="contacto.html">Contacto</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Carrusel de Eventos -->
    <section class="events-section">
        <div class="container">
            <h2 style="color: white;">Eventos Destacados</h2>
            <div class="events-carousel">
                <div class="events-slides" id="eventsSlides">
                    <!-- Slide 1 -->
                    <div class="event-slide">
                        <div class="event-content">
                            <h3 class="event-title">Celebración de Cumpleaños</h3>
                            <p class="event-description">Organizamos las mejores fiestas de cumpleaños con decoraciones temáticas, menús personalizados y un ambiente inolvidable. Celebra tus momentos especiales con nosotros y crea recuerdos que durarán toda la vida.</p>
                            <button class="event-btn">Ver más detalles</button>
                        </div>
                    </div>
                    <!-- Slide 2 -->
                    <div class="event-slide">
                        <div class="event-content">
                            <h3 class="event-title">Bodas Inolvidables</h3>
                            <p class="event-description">Nuestro equipo de expertos en bodas se encarga de cada detalle para hacer de tu día especial una experiencia mágica. Desde la decoración floral hasta el banquete, todo está cuidadosamente planeado.</p>
                            <button class="event-btn">Ver más detalles</button>
                        </div>
                    </div>
                    <!-- Slide 3 -->
                    <div class="event-slide">
                        <div class="event-content">
                            <h3 class="event-title">Aniversarios de Oro</h3>
                            <p class="event-description">Celebra tus años de amor con una velada romántica e inolvidable. Ofrecemos paquetes exclusivos para aniversarios con cena gourmet, música en vivo y decoración especial para honrar este momento único.</p>
                            <button class="event-btn">Ver más detalles</button>
                        </div>
                    </div>
                </div>
                <div class="carousel-controls">
                    <button class="prev-btn"><i class="fas fa-chevron-left"></i></button>
                    <button class="next-btn"><i class="fas fa-chevron-right"></i></button>
                </div>
                <div class="carousel-indicators">
                    <div class="indicator-serv active" data-index="0"></div>
                    <div class="indicator-serv" data-index="1"></div>
                    <div class="indicator-serv" data-index="2"></div>
                </div>
            </div>
        </div>
    </section>

    <!-- Servicios -->
    <section class="services-section">
        <div class="container">
            <h2>Nuestros Servicios</h2>
            <div class="services-grid">
                <!-- Servicio 1 -->
                <div class="service-card">
                    <div class="service-image" style="background-image: url('https://images.unsplash.com/photo-1540575467063-178a50c2df87?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80');"></div>
                    <div class="service-content">
                        <h3 class="service-title">Cumpleaños</h3>
                        <div class="service-features">
                            <div class="feature-item">
                                <i class="fas fa-check-circle"></i>
                                <span>Decoración temática personalizada</span>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-check-circle"></i>
                                <span>Menú especial para niños y adultos</span>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-check-circle"></i>
                                <span>Animación y juegos para niños</span>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-check-circle"></i>
                                <span>Área de juegos segura</span>
                            </div>
                        </div>
                        <button class="btn-reservar" data-service="Cumpleanos">Reservar Ahora</button>
                    </div>
                </div>
                
                <!-- Servicio 2 -->
                <div class="service-card">
                    <div class="service-image" style="background-image: url('https://images.unsplash.com/photo-1580545994623-1a1d3e5f8c7f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80');"></div>
                    <div class="service-content">
                        <h3 class="service-title">Matrimonios</h3>
                        <div class="service-features">
                            <div class="feature-item">
                                <i class="fas fa-check-circle"></i>
                                <span>Ceremonia y recepción en un solo lugar</span>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-check-circle"></i>
                                <span>Menú de banquete gourmet</span>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-check-circle"></i>
                                <span>Coordinador de bodas profesional</span>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-check-circle"></i>
                                <span>Decoración floral y de ambiente</span>
                            </div>
                        </div>
                        <button class="btn-reservar" data-service="Matrimonios">Reservar Ahora</button>
                    </div>
                </div>
                
                <!-- Servicio 3 -->
                <div class="service-card">
                    <div class="service-image" style="background-image: url('https://images.unsplash.com/photo-1556912167-f556f1f39fdf?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80');"></div>
                    <div class="service-content">
                        <h3 class="service-title">Aniversarios</h3>
                        <div class="service-features">
                            <div class="feature-item">
                                <i class="fas fa-check-circle"></i>
                                <span>Cena romántica con vista especial</span>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-check-circle"></i>
                                <span>Paquete fotográfico para recuerdos</span>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-check-circle"></i>
                                <span>Brindis con vino espumante</span>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-check-circle"></i>
                                <span>Postre especial con decoración</span>
                            </div>
                        </div>
                        <button class="btn-reservar" data-service="Aniversarios">Reservar Ahora</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Modal de Reserva de Servicio -->
    <div id="reservaModal" class="modal-serv">
        <div class="modal-serv-content">
            <span class="close">&times;</span>
            <h2 id="modal-title">Reservar Servicio</h2>
            <form id="reservaForm">
                <input type="hidden" id="servicio" name="servicio">
                <div class="form-group">
                    <label for="nombre">Nombre Completo:</label>
                    <input type="text" id="nombre" name="nombre" required>
                </div>
                <div class="form-group">
                    <label for="correo">Correo Electrónico:</label>
                    <input type="email" id="correo" name="correo" required>
                </div>
                <div class="form-group">
                    <label for="telefono">Teléfono:</label>
                    <input type="tel" id="telefono" name="telefono" required>
                </div>
                <div class="form-group">
    			<label for="fecha_entrada">Fecha y Hora de Entrada:</label>
    			<input type="datetime-local" id="fecha_entrada" name="fecha_entrada" required min="">
		</div>
		<div class="form-group">
    			<label for="fecha_salida">Fecha y Hora de Salida:</label>
    			<input type="datetime-local" id="fecha_salida" name="fecha_salida" required>
		</div>
                <button type="submit">Confirmar Reserva</button>
            </form>
        </div>
    </div>

    <!-- Modal de Confirmación -->
    <div id="confirmacionModal" class="modal-serv">
        <div class="modal-serv-content confirmation-modal">
            <span class="close">&times;</span>
            <div class="confirmation-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <h2 class="confirmation-title">¡Reserva Exitosa!</h2>
            
            <div class="confirmation-details">
                <p><strong>Servicio:</strong> <span id="conf-servicio"></span></p>
                <p><strong>Nombre:</strong> <span id="conf-nombre"></span></p>
                <p><strong>Fecha y Hora de Entrada:</strong> <span id="conf-fecha-entrada"></span></p>
		<p><strong>Fecha y Hora de Salida:</strong> <span id="conf-fecha-salida"></span></p>
                <p><strong>Código de Reserva:</strong></p>
                <div class="confirmation-code" id="conf-codigo"></div>
            </div>
            
            <div class="payment-info">
                <h3>Instrucciones de Pago</h3>
                <p>Para confirmar tu reserva, debes realizar un pago del 25% (S/ 160) dentro de las próximas 8 horas.</p>
                <ul>
                    <li>Pago fijo: S/ 160 (por 8 horas)</li>
                    <li>Cada hora extra: S/ 25 adicionales</li>
                    <li>Máximo de personas: 30</li>
                </ul>
                <p>Después del pago, tu reserva quedará confirmada automáticamente.</p>
            </div>
            
            <a href="#" class="whatsapp-btn-serv" id="whatsappBtn">
                <i class="fab fa-whatsapp"></i> Realizar Pago por WhatsApp
            </a>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-grid">
                <div class="footer-section">
                    <h3>Acerca de Nosotros</h3>
                    <p>Shumak Ware es un hotel-restaurante campestre que combina la naturaleza con la comodidad</p>
                </div>
                <div class="footer-section">
                    <h3>Enlaces Rápidos</h3>
                    <ul>
                        <li><a href="index.html">Inicio</a></li>
                        <li><a href="habitaciones.html">Habitaciones</a></li>
                        <li><a href="restaurante.html">Restaurante</a></li>
                        <li><a href="servicios.html">Servicios</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Contacto</h3>
                    <ul>
                        <li><i class="fas fa-phone"></i> +51 912 345 678</li>
                        <li><i class="fas fa-envelope"></i> shumakware@gmail.com</li>
                        <li><i class="fas fa-map-marker-alt"></i> Anta, Huaraz, Ancash</li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                &copy; 2023 Shumak Ware. Todos los derechos reservados.
            </div>
        </div>
    </footer>

    <script>
    // Configuración e inicialización de Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyApq_K7pJmtrLNZcewzxaVXWnVf4Sxynv4",
        authDomain: "shumak-ware.firebaseapp.com",
        databaseURL: "https://shumak-ware-default-rtdb.firebaseio.com",
        projectId: "shumak-ware",
        storageBucket: "shumak-ware.firebasestorage.app",
        messagingSenderId: "64196160181",
        appId: "1:64196160181:web:76852cef50c12a498e6cfc",
        measurementId: "G-8L85H7B12E"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database(); // Usaremos db para referirnos a la base de datos
    // Elementos del DOM
    const eventsSlides = document.getElementById('eventsSlides');
    const eventSlides = eventsSlides.querySelectorAll('.event-slide');
    const prevBtn = document.querySelector('.prev-btn');
    const nextBtn = document.querySelector('.next-btn');
    const indicators = document.querySelectorAll('.indicator-serv');
    const reservaModal = document.getElementById('reservaModal');
    const confirmacionModal = document.getElementById('confirmacionModal');
    const reservaBtns = document.querySelectorAll('.btn-reservar');
    const closeBtns = document.querySelectorAll('.close');
    const modalTitle = document.getElementById('modal-title');
    const servicioInput = document.getElementById('servicio');
    const fechaEntradaInput = document.getElementById('fecha_entrada');
    const fechaSalidaInput = document.getElementById('fecha_salida');
    const reservaForm = document.getElementById('reservaForm');
    const whatsappBtn = document.getElementById('whatsappBtn');
    const confServicio = document.getElementById('conf-servicio');
    const confNombre = document.getElementById('conf-nombre');
    const confFecha = document.getElementById('conf-fecha');
    const confFechaEntrada = document.getElementById('conf-fecha-entrada');
    const confFechaSalida = document.getElementById('conf-fecha-salida');
    const confCodigo = document.getElementById('conf-codigo');
    // Variables de estado
    let currentSlideIndex = 0;
    let codigoReserva = ""; // Ahora es let
        
    // Inicialización del carrusel
    function initCarousel() {
        updateSlider();
        prevBtn.addEventListener('click', () => {
            currentSlideIndex = (currentSlideIndex - 1 + eventSlides.length) % eventSlides.length;
            updateSlider();
        });
        nextBtn.addEventListener('click', () => {
            currentSlideIndex = (currentSlideIndex + 1) % eventSlides.length;
            updateSlider();
        });
        setInterval(() => {
            currentSlideIndex = (currentSlideIndex + 1) % eventSlides.length;
            updateSlider();
        }, 5000);
        indicators.forEach(indicator => {
            indicator.addEventListener('click', () => {
                currentSlideIndex = parseInt(indicator.dataset.index);
                updateSlider();
            });
        });
    }
    function updateSlider() {
        eventsSlides.style.transform = `translateX(-${currentSlideIndex * 100}%)`;
        indicators.forEach((indicator, i) => {
            indicator.classList.toggle('active', i === currentSlideIndex);
        });
    }
    // Inicialización de modales
    function initModals() {
        // Fecha mínima hoy
        fechaEntradaInput.min = new Date().toISOString().slice(0, 16);
        // Abrir modal de reserva
        reservaBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const service = btn.dataset.service;
                modalTitle.textContent = `Reservar ${service}`;
                servicioInput.value = service;
                reservaModal.style.display = 'block';
            });
        });
        // Cerrar modales
        closeBtns.forEach(btn => {
            btn.addEventListener('click', closeModals);
        });
        // Cerrar al hacer clic fuera
        window.addEventListener('click', (e) => {
            if (e.target === reservaModal || e.target === confirmacionModal) {
                closeModals();
            }
        });
    }
    function closeModals() {
        reservaModal.style.display = 'none';
        confirmacionModal.style.display = 'none';
    }
    //manejo de reservas
	async function confirmarReserva(clienteActual,codigoReserva){
    	try {

	const entradaCliente = new Date(clienteActual.fechaEntrada);
        const salidaCliente = new Date(clienteActual.fechaSalida);
        const hoy = new Date();

	if (entradaCliente < hoy) {
        	alert("No se puede reservar en una fecha pasada");
            return false;
        }
        
        if (salidaCliente <= entradaCliente){
        alert("La fecha de entrada debe ser antes de la salida");
        return false;
        }
		
    	const refReservas = db.ref('services');
        const snapshot = await refReservas.once('value');
        const reservas = snapshot.val();
        
        if (reservas) {
        	for(const key in reservas) {
                const reserva = reservas[key];
                const entradaExistente = new Date(reserva.fechaEntrada);
                const salidaExistente = new Date(reserva.fechaSalida);
                if(salidaCliente > entradaExistente && entradaCliente < salidaExistente){
                    	alert("Pruebe otro horario");
                        return false;
                }
            } 			
        
        }
        await refReservas.child(codigoReserva).set(clienteActual);
       return true;
       } catch (error) {
       		alert(`Lo sentimos hubo un error al cargar sus datos. Error: ${error}`);
            return false;
       }
    }
   
    document.addEventListener('DOMContentLoaded', () => {
	initCarousel();
        initModals();
	    
        reservaForm.addEventListener('submit', async function(e){
        	e.preventDefault();
            
        	// Obtener datos del formulario
        const nombre = document.getElementById('nombre').value;
        const correo = document.getElementById('correo').value;
        const telefono = document.getElementById('telefono').value;
        const fechaEntrada = fechaEntradaInput.value;
	const fechaSalida = fechaSalidaInput.value;
        const servicio = servicioInput.value;

        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(correo)) {
            alert("Por favor, introduce un correo electrónico válido.");
            return;
        }
    	
        const clienteData = {
            nombre,
            correo,
            telefono,
            fechaEntrada,
   	    fechaSalida,
            servicio
        };
        codigoReserva = "SEV" + Math.floor(1000000000 + Math.random() * 9000000000).toString();

        try {
        const reservaExitosa = await confirmarReserva(clienteData,codigoReserva);
        if (reservaExitosa) {
		// Función para formatear fecha y hora
		function formatDateTime(datetimeStr) {
    			const options = { 
        		year: 'numeric', 
        		month: 'long', 
        		day: 'numeric',
        		hour: '2-digit', 
        		minute: '2-digit',
        		hour12: true
    		};
    		return new Date(datetimeStr).toLocaleString('es-ES', options);
		}
		
        	// Actualizar modal de confirmación
            confServicio.textContent = servicio;
            confNombre.textContent = nombre;
            confFechaEntrada.textContent = formatDateTime(fechaEntrada);
	    confFechaSalida.textContent = formatDateTime(fechaSalida);
            confCodigo.textContent = codigoReserva;
            // Configurar WhatsApp
            const mensaje = `Hola, acabo de realizar una reserva para ${servicio} en Shumak Ware.%0A%0A` +
                            `*Código de Reserva:* ${codigoReserva}%0A` +
                            `*Nombre:* ${nombre}%0A` +
                            `*Fecha/Hora Entrada:* ${formatDateTime(fechaEntrada)}%0A` +
                	    `*Fecha/Hora Salida:* ${formatDateTime(fechaSalida)}%0A%0A` +
                            `Quiero realizar el pago del 25% para confirmar mi reserva.`;
            whatsappBtn.href = `https://wa.me/51987957231?text=${encodeURIComponent(mensaje)}`;
            // Mostrar confirmación
            reservaModal.style.display = 'none';
            confirmacionModal.style.display = 'block';
            // Resetear formulario
            reservaForm.reset();
        }
            
        } catch (error) {
            alert(`Error: ${error}`);
        }
    });
  });
</script>
</body>
</html>
